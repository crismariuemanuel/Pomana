<div class="develop-container">
  <mat-card class="develop-card">
    <mat-card-header>
      <mat-card-title>Develop - Cause Management</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      @if (isLoading()) {
        <div class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Loading causes...</p>
        </div>
      } @else if (loadError()) {
        <div class="error-container">
          <p class="error-text">{{ loadError() }}</p>
          <button mat-raised-button color="primary" (click)="loadCauses()">Retry</button>
        </div>
      } @else if (causes().length === 0) {
        <div class="empty-container">
          <p>No causes found.</p>
        </div>
      } @else {
        <table mat-table [dataSource]="causes()" class="causes-table">
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let cause">{{ cause.id }}</td>
          </ng-container>

          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>Title</th>
            <td mat-cell *matCellDef="let cause">{{ cause.title }}</td>
          </ng-container>

          <ng-container matColumnDef="owner">
            <th mat-header-cell *matHeaderCellDef>Owner</th>
            <td mat-cell *matCellDef="let cause">
              {{ cause.owner_full_name || cause.owner_email || ('User #' + (cause.owner_user_id || 'N/A')) }}
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let cause">
              <span class="status-badge status-{{ cause.status?.toLowerCase() || 'unknown' }}">
                {{ getStatusLabel(cause.status) }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="is_public">
            <th mat-header-cell *matHeaderCellDef>Public</th>
            <td mat-cell *matCellDef="let cause">
              <span [class]="cause.is_public ? 'public-badge public' : 'public-badge not-public'">
                {{ cause.is_public ? 'Yes' : 'No' }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="actions-header">Actions</th>
            <td mat-cell *matCellDef="let cause" class="actions-cell">
              <div class="action-buttons">
                <button
                  mat-raised-button
                  color="primary"
                  (click)="onViewDetails(cause.id)"
                  class="view-button"
                >
                  View Details
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  (click)="onDelete(cause)"
                  [disabled]="deletingIds().has(cause.id)"
                  class="delete-button"
                >
                  @if (deletingIds().has(cause.id)) {
                    <mat-spinner diameter="20"></mat-spinner>
                  } @else {
                    <mat-icon>delete</mat-icon>
                  }
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      }
    </mat-card-content>
  </mat-card>
</div>
